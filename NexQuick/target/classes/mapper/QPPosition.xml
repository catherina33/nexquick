<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
      
 <mapper namespace="qpPosition">
 
  	<resultMap type="QPPosition" id="QPPositionResultMap">
 		<id column="qpId" property="qpId"/>	
		<result column="qpLatitude" property="qpLatitude" />
		<result column="qpLongitude" property="qpLongitude" />
		<result column="bCode" property="bCode" />
		<result column="hCode" property="hCode" />
 	</resultMap>
 	
<!--insert, delete, update, select(지역코드로, qpId로) -->
	<insert id="createQP" parameterType="QPPosition">
		insert into qpPosition
		values(#{qpId},#{qpLatitude},#{qpLongitude},#{bCode}, #{hCode})
	</insert>
	<delete id="deleteQP" parameterType="int">
		delete qpPosition where qpId=#{qpId}
	</delete>
	<update id="updateQPPosition" parameterType="QPPosition">
		update  qpPosition
		set qpLatitude=#{qpLatitude},
			qpLongitude=#{qpLongitude},
			bCode=#{bCode},
			hCode=#{hCode}
		where qpId=#{qpId}
	</update>
	<select id="selectQPbyId" parameterType="int" resultType="QPPosition">
		select * from qpPosition
		where qpId=#{qpId}
	</select>
	<select id="selectQPbybCode" parameterType="int">
		select * from qpPosition
		where substr(bCode, 0, 3)=substr(#{bCode}, 0, 3)
		order by abs(to_number(#{bCode})-to_number(bCode)),
		abs(power(qplatitude-#{qpLatitude}, 2)+power(qplongitude-#{qpLongitude}, 2));
	</select>
		<select id="selectQPbyhCode" parameterType="int">
		select * from qpPosition
		where substr(hCode, 0, 3)=substr(#{hCode}, 0, 3)
		order by abs(to_number(#{hCode})-to_number(hCode)),
		abs(power(qplatitude-#{qpLatitude}, 2)+power(qplongitude-#{qpLongitude}, 2));
	</select>
 </mapper>